<!doctype html>
<html lang="en">
    <head>
        <title>Title</title>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />

        <!-- Bootstrap CSS v5.2.1 -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />
    </head>

    <body>
        <header>
            <!-- place navbar here -->
        </header>
        <main>
          <div class="section">
            <div class="row">
              <div class="col">
                <div class="container">
                  <form id="email-form1">
                    <!-- Hidden Form Fields -->
                    <input type="hidden" name="IsPostback" value="true">
                    <input type="hidden" value="%%=v(@utm_source)=%%" name="utm_source" id="utm_source"  />
                    <input type="hidden" value="%%=v(@utm_campaign)=%%" name="utm_campaign" id="utm_campaign"  />
                    <input type="hidden" value="%%=v(@utm_term)=%%" name="utm_term" id="utm_term"  />
                    <input type="hidden" value="%%=v(@utm_content)=%%" name="utm_content" id="utm_content"  />
                    <input type="hidden" value="%%=v(@utm_medium)=%%" name="utm_medium" id="utm_medium"  />
                    <input type="hidden" value="" id="birth_date" name="birth_date" />
                    <div class="mb-3 row">
                      <label
                        for="inputName"
                        class="col-4 col-form-label"
                        >Name</label
                      >
                      <div
                        class="col-8"
                      >
                        <input
                          type="text"
                          class="form-control"
                          name="first_name"
                          id="first_name"
                          placeholder="First Name"
                        />
                      </div>
                    </div>
                    <div class="mb-3 row">
                      <label
                        for="email"
                        class="col-4 col-form-label"
                        >Email</label
                      >
                      <div
                        class="col-8"
                      >
                        <input
                          type="text"
                          class="form-control"
                          name="email"
                          id="email"
                          placeholder="Email"
                        />
                      </div>
                    </div>
                    <div class="mb-3 row">
                      <label
                        for="birth_date"
                        class="col-4 col-form-label"
                        >Bith Date</label
                      >
                      <div
                        class="col-8"
                      >
                        <input
                          type="text"
                          class="form-control"
                          name="input_birth_date"
                          id="input_birth_date"
                          placeholder="31/12/1924"
                          onblur="fixDate()"
                        />
                      </div>
                    </div>
                    <div class="mb-3 row">
                      <div class="offset-sm-4 col-sm-8">
                        <button type="submit" class="btn btn-primary">
                          Action
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
                
              </div>
            </div>
          </div>
        </main>
        <footer>
            <!-- place footer here -->
        </footer>
        <!-- Bootstrap JavaScript Libraries -->
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"
        ></script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"
        ></script>
        <!-- Required Libraries for Validation -->
        <!-- Jquery -->
        <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=5f355977c8fcce4baf2b8c07" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <!-- Jquery Validate -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
        <!-- Jquery Mask -->
        <script src=" https://igorescobar.github.io/jQuery-Mask-Plugin/js/jquery.mask.min.js"></script>
        <!-- Jquery Custom Methods -->
        <script>
          // Masking the date in the birth_date field so it always matches DD/MM/YYYY
          $(document).ready(function(){
          $('#input_birth_date').mask('00/00/0000');
          });
          function fixDate(){
            var writtenBirthday = $('#input_birth_date').val();
            // check the value the user wrote
            // console.log(writtenBirthday);
            var parts = writtenBirthday.split("/");
            // check if the date is written with its 3 parts
            //console.log(parts.length);
            if (parts.length === 3) {
              var newBirthday = parts[1] + "/" + parts[0] + "/" + parts[2];
              // check if your date is passing correctly
              // console.log('fixed Birthdate for SFMC' + newBirthday);
              return $('#birth_date').val(newBirthday);
            }
          };
          $.validator.addMethod("customBirthday",
            function(value, element) {
              // get current date to calculate age
              var currentDay = new Date();
              // set the months that have 31 days
              var longMonths = ['01','03','05','07','10','12'];
              // split the date in parts for further evaluation
              var parts = value.split("/");
              // Check for date to be completely written
              if (parts.length === 3) {
                var year = parts[2];
                console.log(year);
                var month = parts[1];
                console.log(month);
                var day = parts[0];
                console.log(day);
                // convert the written date into a date object to calculate date
                var trueBirthday = new Date (year, month - 1, day);
                console.log(trueBirthday);
                //Check the input year should not be less than 1900
                if ( year >= 1900 ) {
                  // Check the month should be 12 or less
                  if ( month <= 12 ) {
                    // Check if the year is divisible by 4 <- this rule won't be valid on year 2100
                    if ( year % 4 == 0 ) {
                      // if it is a Leap year make max date in February to be 29th
                      var maxFeb = 29;
                      console.log(maxFeb); 
                    } else {
                      var maxFeb = 28;
                      //else make it to be 28th
                      console.log(maxFeb);
                    }
                    // check what month was written and assign it's max day  
                    if ( month === '02' ) {
                        var maxDay = maxFeb;
                      } else if (longMonths.includes(month)) {
                        var maxDay = 31;
                      } else {
                        var maxDay = 30;
                      }
                      console.log(maxDay);
                      if ( day <= maxDay ){
                        // convert dates to times so we can identify the age in days
                        var diffTime = currentDay.getTime() - trueBirthday.getTime();
                        console.log(diffTime);
                        var diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                        console.log(diffDays);
                        // show if age is older than 18
                        return diffDays >= 6575;
                      }
                    }
                }
              }
            },
            "<div class='regular_required_mesg'>Please check the date, you must be 18 years old or older to participate.</div>"
          );

          $.validator.addMethod("customname",
                    function (value, element) {
                    
                        return /^[a-zA-ZÀÁÂÃÄÅÈÉÊËÌÍÎÏÐÑÒÓÔÕÖØÙÚÛÜÝÞßàáâãäåèéêëìíîïðñòóôõöøùúûüýþÿêçÇ  ]*$/.test(value);
                    },
                    "<div class='regular_required_msg'>Please check your name</div>"
                );
            //custom validation rule
            $.validator.addMethod("customemail", 
                function(value, element) {
                    return /^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(value);
                }, 
                "<div class='regular_required_msg'>Please check your email</div>"
            );
          $('#email-form1').validate({ 
          ignore: ".ignore",
          rules:
            {
              'input_birth_date': {
                required: true,
                customBirthday: true
              },
              'first_name': {
                required: true,
                customname :true
              },
              'email': {
                required: true, 
                customemail : true,
                "remote":
                  {
                    url: '', //insert here your remote validation file
                    type: "post",
                    data:
                      {
                        unique_id: function () {
                          return $('#email').val();
                        }
                      }
                  }          
              },
            },
          messages:
            {
            'first_name':
              {
                required: "<div class='regular_required_msg'>Please check your name</div>"
              },
            'input_date_of_birth': {
              required: "<div class='regular_required_msg'>Please writte your birthdate</div>",
              customBirthday: "<div class='regular_required_msg'>TF is this</div>"
            },
            'email': 
              {
                required: "<div class='regular_required_msg'>Please write your email</div>",
                remote: "<div class='regular_required_msg'>This email is registered</div>"
              },
            'privacy_policy': 
              {
                required: "<div class='regular_required_msg'>Accept privacy policy.</div>"
              }
            },        
              errorPlacement: function(error, element) {
              if  (element.attr("name") == "check1")
                    error.insertAfter(".errorTxt"); 
            else
                error.insertAfter(element);
            },
              submitHandler: function(form) {
          form.submit();
              }
            });
        function myFunction() {
          var x = document.getElementById("myTopnav");
          if (x.className === "topnav") {
            x.className += " responsive";
          } else {
            x.className = "topnav";
          }
        }
      </script>
    </body>
</html>
